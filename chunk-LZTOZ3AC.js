import{a as ue}from"./chunk-UUATVIRP.js";import{a as le,b as de,c as me}from"./chunk-BJ4EUBTB.js";import{a as ce}from"./chunk-D3HCHVYY.js";import{a as se}from"./chunk-XIS6F7BA.js";import{a as ae}from"./chunk-VKYEO6ZW.js";import{b as re}from"./chunk-HWYJJFZ5.js";import{c as ee,d as te,p as ie,r as ne,s as oe}from"./chunk-XDCWJPAS.js";import{$ as K,$a as f,Ab as a,Bb as v,Cb as p,Db as j,Ha as R,Kb as N,Lb as J,M as B,Ma as $,Mb as X,R as T,Vb as Z,W as C,X as y,Y as W,Z as H,a as U,ab as _,b as Y,bb as D,db as I,eb as q,fb as A,gb as d,hb as c,ib as E,jb as m,kb as u,lb as h,mb as w,nb as O,rb as F,sb as M,tb as s,wa as k,xb as G,za as r,zb as b}from"./chunk-C264W5OG.js";var P=class n{generateEventQuiz(t){let e=[];e.push(this.createDateQuestion(t)),e.push(this.createCategoryQuestion(t)),t.keyFacts&&t.keyFacts.length>0&&e.push(...this.createFactQuestions(t)),t.timeline&&t.timeline.length>0&&e.push(this.createTimelineQuestion(t));let i=this.shuffleArray(e);return{eventId:t.id,eventTitle:t.title,questions:i.slice(0,5)}}createDateQuestion(t){let e=new Date(t.date);isNaN(e.getTime())&&(console.warn("Invalid event date:",t.date),e.setFullYear(2020));let i=e.getFullYear(),o=i.toString(),g=[o,(i-1).toString(),(i+1).toString(),(i-2).toString()].filter(S=>S&&S!=="NaN").slice(0,4);for(;g.length<4;){let Q=(i+Math.floor(Math.random()*10)-5).toString();!g.includes(Q)&&Q!=="NaN"&&g.push(Q)}let x=this.shuffleArray(g),z=x.indexOf(o);return{id:`date-${t.id}`,question:`\xBFEn qu\xE9 a\xF1o ocurri\xF3 el evento "${t.title}"?`,options:x,correctAnswer:z>=0?z:0,explanation:`El evento ocurri\xF3 en ${i}.`}}createCategoryQuestion(t){let e=["Ciencia","Pol\xEDtica","Tecnolog\xEDa","Historia","Cultura","Econom\xEDa","Deporte","Arte"],i=t.category.trim(),o=e.filter(z=>z!==i),l=[i,...o.slice(0,3)],g=this.shuffleArray(l),x=g.indexOf(i);return{id:`category-${t.id}`,question:`\xBFA qu\xE9 categor\xEDa pertenece el evento "${t.title}"?`,options:g,correctAnswer:x,explanation:`Este evento pertenece a la categor\xEDa: ${i}.`}}createFactQuestions(t){let e=[];return t.keyFacts.slice(0,2).forEach((o,l)=>{let g={id:`fact-${t.id}-${l}`,question:`Seg\xFAn los datos curiosos del evento, \xBFqu\xE9 es cierto sobre "${o.title}"?`,options:[o.description,this.generateWrongOption(o.description,"distractor1"),this.generateWrongOption(o.description,"distractor2"),this.generateWrongOption(o.description,"distractor3")],correctAnswer:0,explanation:`La respuesta correcta es: ${o.description}`},x=this.shuffleArray(g.options);g.correctAnswer=x.indexOf(o.description),g.options=x,e.push(g)}),e}createTimelineQuestion(t){if(t.timeline.length===0)throw new Error("No timeline data available");let e=t.timeline[Math.floor(Math.random()*t.timeline.length)],i=new Date(e.date);isNaN(i.getTime())&&(console.warn("Invalid timeline date:",e.date),i.setFullYear(2020));let o=i.getFullYear(),l=o.toString(),x=[l,(o-2).toString(),(o+1).toString(),(o-5).toString()].filter(Q=>Q&&Q!=="NaN").slice(0,4);for(;x.length<4;){let L=(o+Math.floor(Math.random()*10)-5).toString();!x.includes(L)&&L!=="NaN"&&x.push(L)}let z=this.shuffleArray(x),S=z.indexOf(l);return{id:`timeline-${t.id}`,question:`\xBFEn qu\xE9 a\xF1o ocurri\xF3 lo siguiente: "${e.event}"?`,options:z,correctAnswer:S>=0?S:0,explanation:`Este evento de la cronolog\xEDa ocurri\xF3 en ${o}.`}}generateWrongOption(t,e){let i={distractor1:"Esta informaci\xF3n no est\xE1 relacionada con el evento principal.",distractor2:"Este dato corresponde a un evento hist\xF3rico diferente.",distractor3:"Esta descripci\xF3n no es exacta seg\xFAn los datos del evento."},o=t.match(/\d+/);if(o){let l=parseInt(o[0]),g=[t.replace(o[0],(l+1).toString()),t.replace(o[0],(l-1).toString()),t.replace(o[0],(l*2).toString())];return g[Math.floor(Math.random()*g.length)]}return i[e]||"Opci\xF3n incorrecta"}shuffleArray(t){let e=t.filter(o=>!(o==null||typeof o=="number"&&isNaN(o)));if(e.length===0)return console.warn("shuffleArray: No valid elements found in array:",t),["Opci\xF3n 1","Opci\xF3n 2","Opci\xF3n 3","Opci\xF3n 4"];let i=[...e];for(let o=i.length-1;o>0;o--){let l=Math.floor(Math.random()*(o+1));[i[o],i[l]]=[i[l],i[o]]}return i}calculateScore(t,e){return t===0?0:Math.round(e/t*100)}getScoreMessage(t){return t>=90?{message:"\xA1Excelente! Eres un verdadero experto en historia.",color:"text-green-600",icon:"fas fa-trophy"}:t>=70?{message:"\xA1Muy bien! Tienes buenos conocimientos sobre este evento.",color:"text-blue-600",icon:"fas fa-medal"}:t>=50?{message:"Bien hecho. Puedes mejorar leyendo m\xE1s sobre el evento.",color:"text-yellow-600",icon:"fas fa-star"}:{message:"Sigue estudiando. \xA1La historia tiene muchos secretos por descubrir!",color:"text-red-600",icon:"fas fa-book"}}static \u0275fac=function(e){return new(e||n)};static \u0275prov=B({token:n,factory:n.\u0275fac,providedIn:"root"})};var _e=(n,t)=>t.questionId;function he(n,t){if(n&1&&(m(0,"div",6),h(1,"i",9),m(2,"p",10),a(3,"Ya has completado este quiz recientemente"),u(),m(4,"p",11),a(5," Podr\xE1s repetirlo el "),m(6,"strong"),a(7),u()()()),n&2){let e=s(2);r(7),v(e.retryAvailableDate)}}function ve(n,t){if(n&1){let e=w();m(0,"div",1)(1,"div",2),h(2,"i",3),m(3,"h3",4),a(4),u(),m(5,"p",5),a(6),u()(),f(7,he,8,1,"div",6),m(8,"button",7),M("click",function(){C(e);let o=s();return y(o.startQuiz())}),h(9,"i",8),a(10),u()()}if(n&2){let e=s();r(4),p("Quiz sobre ",e.event.title),r(2),p(" Pon a prueba tus conocimientos sobre este evento hist\xF3rico. ",(e.quiz==null||e.quiz.questions==null?null:e.quiz.questions.length)||0," preguntas te esperan. "),r(),_(!e.canTakeQuiz&&e.retryAvailableDate?7:-1),r(),b(e.canTakeQuiz?"bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105":"bg-gray-600 text-gray-400 font-bold py-3 px-8 rounded-lg cursor-not-allowed opacity-50"),O("disabled",!e.canTakeQuiz),r(2),p(" ",e.canTakeQuiz?"Comenzar Quiz":"Quiz No Disponible"," ")}}function be(n,t){n&1&&h(0,"div",26)}function Ee(n,t){if(n&1){let e=w();m(0,"div",23),M("click",function(){let o=C(e).$index,l=s(2);return y(l.selectAnswer(o))}),m(1,"div",24)(2,"div",25),f(3,be,1,0,"div",26),u(),m(4,"span",27),a(5),u()()()}if(n&2){let e=t.$implicit,i=t.$index,o=s(2);b(o.selectedAnswers[o.currentQuestionIndex]===i?"bg-purple-600 border-purple-500 text-white":"bg-gray-800 border-gray-600 text-gray-300 hover:border-purple-400 hover:bg-gray-700"),r(2),b(o.selectedAnswers[o.currentQuestionIndex]===i?"border-white bg-white":"border-gray-500"),r(),_(o.selectedAnswers[o.currentQuestionIndex]===i?3:-1),r(2),v(e||"Opci\xF3n no disponible")}}function Ce(n,t){if(n&1){let e=w();m(0,"button",28),M("click",function(){C(e);let o=s(2);return y(o.previousQuestion())}),h(1,"i",29),a(2," Anterior "),u()}}function ye(n,t){n&1&&h(0,"div")}function we(n,t){if(n&1){let e=w();m(0,"button",30),M("click",function(){C(e);let o=s(2);return y(o.nextQuestion())}),a(1," Siguiente "),h(2,"i",31),u()}if(n&2){let e=s(2);O("disabled",!e.hasSelectedAnswer)}}function ze(n,t){if(n&1){let e=w();m(0,"button",32),M("click",function(){C(e);let o=s(2);return y(o.finishQuiz())}),h(1,"i",33),a(2," Finalizar Quiz "),u()}if(n&2){let e=s(2);O("disabled",!e.hasSelectedAnswer)}}function Se(n,t){if(n&1&&(m(0,"div")(1,"div",2)(2,"div",12)(3,"span",13),a(4),u(),m(5,"span",13),a(6),u()(),m(7,"div",14),h(8,"div",15),u()(),m(9,"div",2)(10,"h4",16),a(11),u(),m(12,"div",17),I(13,Ee,6,6,"div",18,D),u()(),m(15,"div",19),f(16,Ce,3,0,"button",20)(17,ye,1,0,"div"),f(18,we,3,1,"button",21)(19,ze,3,1,"button",22),u()()),n&2){let e=s();r(4),j(" Pregunta ",e.currentQuestionIndex+1," de ",(e.quiz==null||e.quiz.questions==null?null:e.quiz.questions.length)||0," "),r(2),p(" ",e.progressPercentage.toFixed(0),"% completado "),r(2),G("width",e.progressPercentage,"%"),r(3),p(" ",e.currentQuestion.question," "),r(2),q(e.currentQuestion.options),r(3),_(e.isFirstQuestion?17:16),r(2),_(e.isLastQuestion?19:18)}}function Qe(n,t){if(n&1&&(m(0,"div",38)(1,"div",47),h(2,"i",48),m(3,"div")(4,"div",49),a(5),u(),m(6,"div",50),a(7,"\xA1Felicitaciones! Has ganado puntos"),u()(),h(8,"i",48),u()()),n&2){let e=s(2);r(5),p(" +",e.quizResult.pointsEarned," puntos ")}}function Ie(n,t){n&1&&(m(0,"div",39)(1,"div",51),h(2,"i",52),a(3," Necesitas al menos 50% para ganar puntos "),u()())}function qe(n,t){if(n&1&&(m(0,"div",40)(1,"div",53),h(2,"i",54),a(3),N(4,"date"),u()()),n&2){let e=s(2);r(3),p(" Podr\xE1s repetir este quiz el ",X(4,1,e.quizResult.canRetryAt,"dd/MM/yyyy")," ")}}function Ae(n,t){if(n&1&&(m(0,"p",61)(1,"strong"),a(2,"Respuesta correcta:"),u(),a(3),u()),n&2){let e=s().$index,i=s(2);r(3),p(" ",i.getCorrectAnswerText(e)," ")}}function Te(n,t){if(n&1&&(m(0,"div",43)(1,"div",55)(2,"div",56),h(3,"i",57),u(),m(4,"div",58)(5,"p",59)(6,"strong"),a(7),u(),a(8),u(),m(9,"p",60)(10,"strong"),a(11,"Tu respuesta:"),u(),a(12),u(),f(13,Ae,4,1,"p",61),u()()()),n&2){let e=t.$implicit,i=t.$index,o=s(2);r(3),b(e.isCorrect?"fas fa-check-circle text-green-500":"fas fa-times-circle text-red-500"),r(4),p("Pregunta ",i+1,":"),r(),p(" ",o.getQuestionText(i)," "),r(),b(e.isCorrect?"text-green-400":"text-red-400"),r(3),p(" ",e.selectedAnswer>=0?o.getOptionText(i,e.selectedAnswer):"Sin respuesta"," "),r(),_(e.isCorrect?-1:13)}}function ke(n,t){if(n&1){let e=w();m(0,"div",1)(1,"div",2)(2,"div",34),a(3),u(),h(4,"i",35),m(5,"h3",4),a(6,"\xA1Quiz Completado!"),u(),m(7,"p",36),a(8),u(),m(9,"div",37),a(10),u(),f(11,Qe,9,1,"div",38)(12,Ie,4,0,"div",39),f(13,qe,5,4,"div",40),u(),m(14,"div",41)(15,"h4",42),a(16,"Resumen de Respuestas"),u(),I(17,Te,14,8,"div",43,_e),u(),m(19,"div",44)(20,"button",45),M("click",function(){C(e);let o=s();return y(o.restartQuiz())}),h(21,"i",46),a(22," Intentar de Nuevo "),u()()()}if(n&2){let e=s();r(2),b(e.scoreMessage==null?null:e.scoreMessage.color),r(),p(" ",e.quizResult.percentage,"% "),r(),b((e.scoreMessage==null?null:e.scoreMessage.icon)+" "+(e.scoreMessage==null?null:e.scoreMessage.color)),r(3),b(e.scoreMessage==null?null:e.scoreMessage.color),r(),p(" ",e.scoreMessage==null?null:e.scoreMessage.message," "),r(2),j(" Respondiste correctamente ",e.quizResult.correctAnswers," de ",e.quizResult.totalQuestions," preguntas. "),r(),_(e.quizResult.pointsEarned!==void 0&&e.quizResult.pointsEarned>0?11:e.quizResult.pointsEarned===0?12:-1),r(2),_(e.quizResult.canRetryAt?13:-1),r(4),q(e.quizResult.answers)}}var V=class n{constructor(t,e,i){this.quizService=t;this.pointsService=e;this.authService=i}event;quiz=null;currentQuestionIndex=0;selectedAnswers=[];showResult=!1;quizResult=null;isQuizStarted=!1;quizStatus=null;isLoadingStatus=!1;isSavingResult=!1;ngOnInit(){this.generateQuiz(),this.loadQuizStatus()}loadQuizStatus(){!this.authService.isAuthenticated()||!this.event||(this.isLoadingStatus=!0,this.pointsService.getQuizStatus(this.event.id).subscribe({next:t=>{this.quizStatus=t.data,this.isLoadingStatus=!1},error:t=>{console.error("Error loading quiz status:",t),this.isLoadingStatus=!1}}))}generateQuiz(){this.event&&(this.quiz=this.quizService.generateEventQuiz(this.event))}startQuiz(){if(this.authService.isAuthenticated()&&this.quizStatus&&!this.quizStatus.can_take){let t=this.quizStatus.retry_available_at;if(t){let e=new Date(t).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}return}this.isQuizStarted=!0,this.currentQuestionIndex=0,this.selectedAnswers=Array(this.quiz?.questions.length||0).fill(null),this.showResult=!1,this.quizResult=null}selectAnswer(t){if(typeof t!="number"||isNaN(t)||t<0){console.warn("Invalid answer index:",t);return}if(typeof this.currentQuestionIndex!="number"||isNaN(this.currentQuestionIndex)||this.currentQuestionIndex<0){console.warn("Invalid current question index:",this.currentQuestionIndex);return}this.selectedAnswers[this.currentQuestionIndex]=t}nextQuestion(){this.currentQuestionIndex<this.quiz.questions.length-1?this.currentQuestionIndex++:this.finishQuiz()}previousQuestion(){this.currentQuestionIndex>0&&this.currentQuestionIndex--}finishQuiz(){if(!this.quiz)return;let t=this.quiz.questions.map((l,g)=>{let x=this.selectedAnswers[g],z=typeof x=="number"&&!isNaN(x)&&x>=0?x:-1,S=l.correctAnswer,Q=typeof S=="number"&&!isNaN(S)&&S>=0?S:-1;return{questionId:l.id,selectedAnswer:z,isCorrect:z===Q&&z!==-1}}),e=t.filter(l=>l.isCorrect).length,i=this.quizService.calculateScore(this.quiz.questions.length,e),o=this.pointsService.calculatePoints(i);this.quizResult={totalQuestions:this.quiz.questions.length,correctAnswers:e,percentage:i,answers:t,pointsEarned:o},this.showResult=!0,this.authService.isAuthenticated()&&this.event&&this.saveQuizResult()}saveQuizResult(){if(!this.quizResult||!this.event)return;this.isSavingResult=!0;let t={event_id:this.event.id,score:this.quizResult.percentage,total_questions:this.quizResult.totalQuestions,correct_answers:this.quizResult.correctAnswers};this.pointsService.completeQuiz(t).subscribe({next:e=>{this.quizResult.pointsEarned=e.data.points_earned,this.quizResult.canRetryAt=e.data.can_retry_at,this.isSavingResult=!1,this.authService.refreshProfile()},error:e=>{console.error("Error saving quiz result:",e),this.isSavingResult=!1}})}restartQuiz(){this.generateQuiz(),this.isQuizStarted=!1,this.currentQuestionIndex=0,this.selectedAnswers=[],this.showResult=!1,this.quizResult=null}get currentQuestion(){let t=this.quiz?.questions[this.currentQuestionIndex];if(!t)return null;let e=t.options.map((i,o)=>i==null||typeof i=="number"&&isNaN(i)?(console.warn(`Invalid option at index ${o}:`,i),`Opci\xF3n ${o+1}`):String(i));return Y(U({},t),{options:e})}get isLastQuestion(){return this.quiz?this.currentQuestionIndex===this.quiz.questions.length-1:!1}get isFirstQuestion(){return this.currentQuestionIndex===0}get hasSelectedAnswer(){let t=this.selectedAnswers[this.currentQuestionIndex];return typeof t=="number"&&!isNaN(t)&&t>=0}get progressPercentage(){return this.quiz?this.selectedAnswers.filter(e=>typeof e=="number"&&!isNaN(e)&&e>=0).length/this.quiz.questions.length*100:0}get scoreMessage(){return this.quizResult?this.quizService.getScoreMessage(this.quizResult.percentage):null}get canTakeQuiz(){return!this.authService.isAuthenticated()||!this.quizStatus?!0:this.quizStatus.can_take}get retryAvailableDate(){return this.quizStatus?.retry_available_at?new Date(this.quizStatus.retry_available_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):null}getQuestionText(t){return typeof t!="number"||isNaN(t)||t<0?"Pregunta no disponible":this.quiz?.questions?.[t]?.question||"Pregunta no disponible"}getOptionText(t,e){return typeof t!="number"||isNaN(t)||t<0||typeof e!="number"||isNaN(e)||e<0?"Opci\xF3n no disponible":this.quiz?.questions?.[t]?.options?.[e]||"Opci\xF3n no disponible"}getCorrectAnswerText(t){if(typeof t!="number"||isNaN(t)||t<0)return"Respuesta no disponible";let e=this.quiz?.questions?.[t];if(!e)return"No disponible";let i=e.correctAnswer;return typeof i!="number"||isNaN(i)||i<0?"Respuesta no disponible":e.options?.[i]||"Respuesta no disponible"}static \u0275fac=function(e){return new(e||n)(R(P),R(se),R(re))};static \u0275cmp=$({type:n,selectors:[["app-quiz"]],inputs:{event:"event"},decls:4,vars:3,consts:[[1,"bg-gradient-to-br","from-gray-900","to-gray-800","rounded-xl","p-6","shadow-2xl","border","border-gray-700"],[1,"text-center"],[1,"mb-6"],[1,"fas","fa-brain","text-4xl","text-purple-500","mb-4"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-white"],[1,"bg-yellow-900/50","border","border-yellow-600","rounded-lg","p-4","mb-4"],[3,"click","disabled"],[1,"fas","fa-play","mr-2"],[1,"fas","fa-clock","text-yellow-400","text-2xl","mb-2"],[1,"text-yellow-200","font-medium","mb-2"],[1,"text-yellow-300","text-sm"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-gray-400"],[1,"w-full","bg-gray-700","rounded-full","h-2"],[1,"bg-purple-500","h-2","rounded-full","transition-all","duration-300"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"space-y-3"],[1,"p-4","rounded-lg","border-2","transition","duration-300","cursor-pointer",3,"class"],[1,"flex","justify-between","items-center"],[1,"bg-gray-600","hover:bg-gray-700","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300"],[1,"bg-purple-600","hover:bg-purple-700","disabled:bg-gray-500","disabled:cursor-not-allowed","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300",3,"disabled"],[1,"bg-green-600","hover:bg-green-700","disabled:bg-gray-500","disabled:cursor-not-allowed","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300",3,"disabled"],[1,"p-4","rounded-lg","border-2","transition","duration-300","cursor-pointer",3,"click"],[1,"flex","items-center"],[1,"w-6","h-6","rounded-full","border-2","mr-3","flex","items-center","justify-center"],[1,"w-2","h-2","rounded-full","bg-purple-600"],[1,"text-sm","font-medium"],[1,"bg-gray-600","hover:bg-gray-700","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300",3,"click"],[1,"fas","fa-arrow-left","mr-2"],[1,"bg-purple-600","hover:bg-purple-700","disabled:bg-gray-500","disabled:cursor-not-allowed","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300",3,"click","disabled"],[1,"fas","fa-arrow-right","ml-2"],[1,"bg-green-600","hover:bg-green-700","disabled:bg-gray-500","disabled:cursor-not-allowed","text-white","font-medium","py-2","px-4","rounded-lg","transition","duration-300",3,"click","disabled"],[1,"fas","fa-flag-checkered","mr-2"],[1,"text-6xl","font-bold","mb-2"],[1,"text-4xl","mb-4"],[1,"text-lg","mb-4"],[1,"text-gray-300","mb-4"],[1,"bg-gradient-to-r","from-yellow-600","to-yellow-500","rounded-lg","p-4","mb-4","animate-pulse"],[1,"bg-gray-700","rounded-lg","p-3","mb-4"],[1,"bg-blue-900/50","rounded-lg","p-3","mb-4","border","border-blue-700"],[1,"bg-gray-800","rounded-lg","p-4","mb-6"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"mb-3","text-left"],[1,"flex","gap-4","justify-center"],[1,"bg-purple-600","hover:bg-purple-700","text-white","font-medium","py-2","px-6","rounded-lg","transition","duration-300",3,"click"],[1,"fas","fa-redo","mr-2"],[1,"flex","items-center","justify-center","gap-2"],[1,"fas","fa-star","text-2xl","text-white"],[1,"text-3xl","font-bold","text-white"],[1,"text-sm","text-yellow-100"],[1,"text-gray-300"],[1,"fas","fa-info-circle","mr-2"],[1,"text-blue-300","text-sm"],[1,"fas","fa-clock","mr-2"],[1,"flex","items-start","gap-3"],[1,"flex-shrink-0"],[1,"text-lg"],[1,"flex-grow"],[1,"text-sm","text-gray-300","mb-1"],[1,"text-xs"],[1,"text-xs","text-green-400"]],template:function(e,i){e&1&&(m(0,"div",0),f(1,ve,11,7,"div",1),f(2,Se,20,8,"div"),f(3,ke,23,12,"div",1),u()),e&2&&(r(),_(!i.isQuizStarted&&!i.showResult?1:-1),r(),_(i.isQuizStarted&&!i.showResult&&i.currentQuestion?2:-1),r(),_(i.showResult&&i.quizResult?3:-1))},dependencies:[te,ee],styles:['@charset "UTF-8";.quiz-container[_ngcontent-%COMP%]{transition:all .3s ease-in-out}.question-option[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.question-option[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #8b5cf64d}.progress-bar[_ngcontent-%COMP%]{transition:width .3s ease-in-out}.score-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scoreReveal .8s ease-out}@keyframes _ngcontent-%COMP%_scoreReveal{0%{opacity:0;transform:scale(.5)}60%{transform:scale(1.1)}to{opacity:1;transform:scale(1)}}.result-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.result-item[_ngcontent-%COMP%]:hover{background-color:#4b55634d}']})};var Fe=(n,t)=>t.title,Me=(n,t)=>t.date;function De(n,t){if(n&1&&(d(0,"p",16),a(1),c()),n&2){let e=t.$implicit;r(),v(e)}}function Re(n,t){if(n&1){let e=w();d(0,"div",31)(1,"div",33)(2,"img",34),F("error",function(o){C(e);let l=s(3);return y(l.onImageError(o))}),c()(),d(3,"div",35)(4,"p",23),a(5),c()()()}if(n&2){let e=s().$implicit,i=s(2);r(2),A("src",i.getAdditionalImage(0),k)("alt",i.event.title),r(3),v(e)}}function $e(n,t){if(n&1){let e=w();d(0,"div",32)(1,"div",33)(2,"img",34),F("error",function(o){C(e);let l=s(3);return y(l.onImageError(o))}),c()(),d(3,"div",35)(4,"p",23),a(5),c()()()}if(n&2){let e=s().$implicit,i=s(2);r(2),A("src",i.getAdditionalImage(1),k)("alt",i.event.title),r(3),v(e)}}function Oe(n,t){if(n&1&&(d(0,"p",23),a(1),c()),n&2){let e=s().$implicit;r(),v(e)}}function Ne(n,t){if(n&1&&f(0,Re,6,3,"div",31)(1,$e,6,3,"div",32)(2,Oe,2,1,"p",23),n&2){let e=t.$index,i=s(2);_(e===0&&i.getAdditionalImage(0)?0:e===2&&i.getAdditionalImage(1)?1:2)}}function Pe(n,t){if(n&1){let e=w();d(0,"div",40)(1,"img",41),F("error",function(o){C(e);let l=s(5);return y(l.onImageError(o))}),c()(),d(2,"div",39)(3,"h3",42),E(4,"i"),a(5),c(),d(6,"p"),a(7),c()()}if(n&2){let e=s(2).$implicit,i=s(3);r(),A("src",i.getAdditionalImage(2),k)("alt",i.event.title),r(3),b(i.getFactIcon(e.title,e.description).icon+" text-sm "+i.getFactIcon(e.title,e.description).color),r(),p(" ",e.title," "),r(2),v(e.description)}}function Ve(n,t){if(n&1){let e=w();d(0,"div",43)(1,"h3",42),E(2,"i"),a(3),c(),d(4,"p"),a(5),c()(),d(6,"div",44)(7,"img",45),F("error",function(o){C(e);let l=s(5);return y(l.onImageError(o))}),c()()}if(n&2){let e=s(2).$implicit,i=s(3);r(2),b(i.getFactIcon(e.title,e.description).icon+" text-sm "+i.getFactIcon(e.title,e.description).color),r(),p(" ",e.title," "),r(2),v(e.description),r(2),A("src",i.getAdditionalImage(3),k)("alt",i.event.title)}}function Le(n,t){if(n&1){let e=w();d(0,"div",40)(1,"img",41),F("error",function(o){C(e);let l=s(5);return y(l.onImageError(o))}),c()(),d(2,"div",39)(3,"h3",42),E(4,"i"),a(5),c(),d(6,"p"),a(7),c()()}if(n&2){let e=s(2).$implicit,i=s(3);r(),A("src",i.getAdditionalImage(4),k)("alt",i.event.title),r(3),b(i.getFactIcon(e.title,e.description).icon+" text-sm "+i.getFactIcon(e.title,e.description).color),r(),p(" ",e.title," "),r(2),v(e.description)}}function je(n,t){if(n&1&&(d(0,"div",39)(1,"h3",42),E(2,"i"),a(3),c(),d(4,"p"),a(5),c()()),n&2){let e=s(2).$implicit,i=s(3);r(2),b(i.getFactIcon(e.title,e.description).icon+" text-sm "+i.getFactIcon(e.title,e.description).color),r(),p(" ",e.title," "),r(2),v(e.description)}}function Ue(n,t){if(n&1&&f(0,Pe,8,6)(1,Ve,8,6)(2,Le,8,6)(3,je,6,4,"div",39),n&2){let e=s(),i=e.$index,o=e.$count,l=s(3);_(i===0&&l.getAdditionalImage(2)?0:i===4&&l.getAdditionalImage(3)?1:i===o-1&&l.event.keyFacts.length%2!==0&&l.getAdditionalImage(4)?2:3)}}function Ye(n,t){if(n&1&&f(0,Ue,4,1),n&2){let e=t.$implicit;_(e.title&&e.description?0:-1)}}function Be(n,t){if(n&1&&(d(0,"div",20)(1,"h2",36),E(2,"img",37),a(3," Datos Curiosos "),c(),d(4,"div",38),I(5,Ye,1,1,null,null,Fe),c()()),n&2){let e=s(2);r(5),q(e.event.keyFacts)}}function We(n,t){if(n&1&&(d(0,"div",49)(1,"div",50),E(2,"i"),d(3,"div",51),a(4),c()(),d(5,"div",52)(6,"p",53),a(7),c()()()),n&2){let e=s().$implicit,i=s(3);r(2),b(i.getTimelineIcon(e.date).icon+" text-lg "+i.getTimelineIcon(e.date).color),r(2),v(e.date),r(3),v(e.event)}}function He(n,t){if(n&1&&f(0,We,8,4,"div",49),n&2){let e=t.$implicit;_(e.date&&e.event?0:-1)}}function Ke(n,t){if(n&1&&(d(0,"div",20)(1,"h2",46),E(2,"img",47),a(3," Cronolog\xEDa "),c(),d(4,"div",48),I(5,He,1,1,null,null,Me),c()()),n&2){let e=s(2);r(5),q(e.event.timeline)}}function Ge(n,t){if(n&1&&(d(0,"p",23),a(1),c()),n&2){let e=t.$implicit;r(),v(e)}}function Je(n,t){if(n&1){let e=w();d(0,"div",1)(1,"img",2),F("error",function(o){C(e);let l=s();return y(l.onImageError(o))}),c(),E(2,"div",3),d(3,"div",4)(4,"a",5),W(),d(5,"svg",6),E(6,"path",7),c(),a(7," Volver "),c()(),H(),d(8,"div",8)(9,"div",9)(10,"span"),a(11),c(),d(12,"h1",10),a(13),c(),d(14,"p",11),a(15),N(16,"dateFormat"),c()()()(),d(17,"div",12)(18,"div",13)(19,"h2",14),E(20,"img",15),a(21," Resumen "),c(),I(22,De,2,1,"p",16,D),c(),d(24,"div",13)(25,"h2",17),E(26,"img",18),a(27," Contexto Hist\xF3rico "),c(),d(28,"div",19),I(29,Ne,3,1,null,null,D),c()(),f(31,Be,7,0,"div",20),f(32,Ke,7,0,"div",20),d(33,"div",13)(34,"h2",21),E(35,"img",22),a(36," Consecuencias y Legado "),c(),d(37,"div",19),I(38,Ge,2,1,"p",23,D),c()(),d(40,"div",24)(41,"h2",25),E(42,"img",26),a(43," Quiz Interactivo "),c(),E(44,"app-quiz",27),c()(),d(45,"div",28)(46,"div",29)(47,"a",30),a(48," Volver a los Eventos "),c()()()}if(n&2){let e=s();r(),A("src",e.event.imageUrl,k)("alt",e.event.title),r(9),b("mb-4 inline-block rounded-full px-4 py-1 text-sm font-bold uppercase tracking-wider text-color "+e.getCategoryColor(e.event.category)),r(),p(" ",e.event.category," "),r(2),v(e.event.title),r(2),v(J(16,10,e.event.date)),r(7),q(e.getParagraphs(e.event.summary)),r(7),q(e.getParagraphs(e.event.context)),r(2),_(e.hasValidKeyFacts()?31:-1),r(),_(e.hasValidTimeline()?32:-1),r(6),q(e.getParagraphs(e.event.consequences)),r(6),A("event",e.event)}}var ge=class n{eventApiService=T(ce);route=T(ie);router=T(ne);cdr=T(Z);seo=T(ae);document=T(K);event;getCategoryColor=de;getParagraphs=me;defaultImage="https://placehold.co/1200x600/1F2937/FFFFFF?text=Evento+Hist%C3%B3rico";ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t?(console.log("Loading event from database:",t),this.eventApiService.getEventById(t).subscribe({next:e=>{if(!e){console.error("Event not found:",t),this.router.navigate(["/"]);return}console.log("Event loaded successfully:",e),this.event=this.loadAdditionalImages(e),this.updateSeoTags(e),this.addStructuredData(e),this.cdr.markForCheck()},error:e=>{console.error("Error loading event:",e),this.router.navigate(["/"])}})):this.router.navigate(["/"])}updateSeoTags(t){let e=Array.isArray(t.summary)?t.summary[0].substring(0,160):t.summary.substring(0,160),i=t.imageUrl.startsWith("http")?t.imageUrl:`https://epicstoria.com${t.imageUrl}`;this.seo.updateMetaTags({title:t.title,description:`${e}...`,keywords:`historia, ${t.category}, ${t.title}, ${t.date}`,image:i,url:`https://epicstoria.com/evento/${t.slug||t.id}`,type:"article"}),this.seo.updateCanonicalUrl(`https://epicstoria.com/evento/${t.slug||t.id}`)}addStructuredData(t){let e=Array.isArray(t.summary)?t.summary.join(" "):t.summary,i=t.imageUrl.startsWith("http")?t.imageUrl:`https://epicstoria.com${t.imageUrl}`,o=this.document.querySelector('script[type="application/ld+json"][data-event-schema]');o&&o.remove();let l=this.document.createElement("script");l.type="application/ld+json",l.setAttribute("data-event-schema","true"),l.text=JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:t.title,description:e.substring(0,300),image:i,datePublished:t.date,dateModified:t.date,author:{"@type":"Organization",name:"Epicstoria",url:"https://epicstoria.com"},publisher:{"@type":"Organization",name:"Epicstoria",url:"https://epicstoria.com",logo:{"@type":"ImageObject",url:"https://epicstoria.com/favicon.ico"}},mainEntityOfPage:{"@type":"WebPage","@id":`https://epicstoria.com/evento/${t.slug||t.id}`},articleSection:t.category,keywords:`historia, ${t.category}, ${t.title}`,inLanguage:"es-ES"}),this.document.head.appendChild(l)}loadAdditionalImages(t){if(!t.imageUrl||t.additionalImages&&t.additionalImages.length>0)return t;let i=t.imageUrl.replace(/^\//,"").match(/^(.+\/)?(.+?)(\.[^.]+)$/);if(!i)return t;let o=i[1]||"",l=i[2],g=i[3],x=[];return t}async onImageError(t){let e=t.target;await ue(t,e.src,this.defaultImage)}getAdditionalImage(t){return!this.event?.additionalImages||t>=this.event.additionalImages.length?null:this.event.additionalImages[t]}hasAdditionalImages(){return!!this.event?.additionalImages&&this.event.additionalImages.length>0}hasValidKeyFacts(){return!!(this.event?.keyFacts&&this.event.keyFacts.length>0&&this.event.keyFacts.some(t=>t.title&&t.description))}hasValidTimeline(){return!!(this.event?.timeline&&this.event.timeline.length>0&&this.event.timeline.some(t=>t.date&&t.event))}getFactIcon(t,e){let i=(t+" "+e).toLowerCase();return i.includes("distancia")||i.includes("kil\xF3metros")||i.includes("alejado")||i.includes("espacio")||i.includes("a\xF1os luz")?{icon:"fas fa-rocket",color:"text-blue-500"}:i.includes("tiempo")||i.includes("a\xF1os")||i.includes("horas")||i.includes("d\xEDas")||i.includes("duraci\xF3n")?{icon:"fas fa-clock",color:"text-green-500"}:i.includes("m\xFAsica")||i.includes("sonidos")||i.includes("disco")||i.includes("audio")?{icon:"fas fa-music",color:"text-purple-500"}:i.includes("mensaje")||i.includes("idiomas")||i.includes("comunicaci\xF3n")||i.includes("saludos")?{icon:"fas fa-comment",color:"text-blue-400"}:i.includes("primera")||i.includes("primer")||i.includes("\xFAnico")||i.includes("primero")?{icon:"fas fa-trophy",color:"text-yellow-500"}:i.includes("tierra")||i.includes("planeta")||i.includes("mundo")||i.includes("global")?{icon:"fas fa-globe",color:"text-green-400"}:i.includes("tecnolog\xEDa")||i.includes("instrumento")||i.includes("equipo")||i.includes("dispositivo")?{icon:"fas fa-cog",color:"text-gray-500"}:i.includes("descubrimiento")||i.includes("hallazgo")||i.includes("encontr\xF3")||i.includes("revel\xF3")?{icon:"fas fa-search",color:"text-orange-500"}:i.includes("cient\xEDfico")||i.includes("investigaci\xF3n")||i.includes("estudio")||i.includes("ciencia")?{icon:"fas fa-flask",color:"text-cyan-500"}:i.includes("r\xE9cord")||i.includes("m\xE1ximo")||i.includes("mayor")||i.includes("extremo")?{icon:"fas fa-medal",color:"text-amber-500"}:{icon:"fas fa-star",color:"text-yellow-500"}}getTimelineIcon(t){let e=parseInt(t.split("-")[0]);return e<500?{icon:"fas fa-mountain",color:"text-amber-800"}:e>=500&&e<1450?{icon:"fas fa-chess-rook",color:"text-gray-600"}:e>=1450&&e<1800?{icon:"fas fa-feather",color:"text-purple-600"}:e>=1800&&e<1900?{icon:"fas fa-industry",color:"text-orange-600"}:e>=1900&&e<1950?{icon:"fas fa-car",color:"text-blue-600"}:e>=1950&&e<1990?{icon:"fas fa-rocket",color:"text-cyan-500"}:e>=1990&&e<2010?{icon:"fas fa-desktop",color:"text-green-500"}:{icon:"fas fa-wifi",color:"text-blue-400"}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=$({type:n,selectors:[["app-event-detail"]],decls:2,vars:1,consts:[[1,"min-h-screen"],[1,"relative","h-96","overflow-hidden"],["loading","eager",1,"heigth-full","w-full","object-cover","opacity-60",3,"error","src","alt"],[1,"absolute","inset-0","bg-gradient-to-t","from-gray-900","to-transparent"],[1,"absolute","left-4","top-4","sm:left-8","sm:top-8"],["routerLink","/",1,"btns-color","inline-flex","items-center","rounded-full","bg-gray-800/80","px-4","py-2","text-sm","font-medium","text-white","backdrop-blur-sm","transition","duration-150","hover:bg-gray-700"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"mr-2","h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"absolute","bottom-0","left-0","right-0","p-8"],[1,"mx-auto","max-w-5xl"],[1,"text-color","mb-2","text-5xl","font-black","md:text-6xl"],[1,"text-xl","font-semibold","text-color"],[1,"mx-auto","max-w-5xl","px-4","py-12","sm:px-6","lg:px-8"],[1,"mb-12","rounded-xl","container-custom","p-8","shadow-2xl"],[1,"mb-4","text-2xl","font-bold","flex","items-center","gap-3","border-title","pb-2"],["src","images/logos/resumen.png","alt","Icono de Resumen del evento","loading","lazy",1,"h-14"],[1,"mb-4","text-lg","leading-relaxed"],[1,"mb-6","border-title","pb-2","text-3xl","font-bold","flex","items-center","gap-3"],["src","images/logos/contexto.png","alt","Icono de Contexto Hist\xF3rico","loading","lazy",1,"h-14"],[1,"space-y-4"],[1,"mb-12","container-custom","px-6","rounded-xl","py-3"],[1,"border-title","mb-6","text-3xl","font-bold","flex","items-center","gap-3","pb-2"],["src","images/logos/consecuencias-legado.png","alt","Icono de Consecuencias y Legado hist\xF3rico","loading","lazy",1,"h-14"],[1,"text-lg","leading-relaxed"],[1,"mb-12"],[1,"mb-6","text-3xl","font-bold","text-color","flex","items-center","gap-3"],["src","images/logos/quiz-interactivo.png","alt","Icono de Quiz Interactivo sobre el evento","loading","lazy",1,"h-14"],[3,"event"],[1,"pt-12"],[1,"flex","justify-center","gap-4"],["routerLink","/eventos",1,"btns-color","rounded-full","px-8","py-3","font-semibold","shadow-lg","transition","duration-150"],[1,"flex","flex-col","md:flex-row","gap-6","items-start"],[1,"flex","flex-col","md:flex-row-reverse","gap-6","items-start"],[1,"md:w-1/3"],["loading","lazy",1,"w-full","h-auto","rounded-lg","shadow-lg","object-cover","imagen-dato-curioso",3,"error","src","alt"],[1,"md:w-2/3"],[1,"mb-6","text-3xl","font-bold","flex","items-center","gap-3"],["src","images/logos/datos-curiosos.png","alt","Icono de Datos Curiosos e interesantes","loading","lazy",1,"h-14"],[1,"grid","gap-6","md:grid-cols-2"],[1,"rounded-xl","container-custom","p-6","transition","duration-300","hover:border-blue-500/50","hover:shadow-xl"],[1,"rounded-xl","overflow-hidden"],["loading","lazy",1,"imagen-dato-curioso",3,"error","src","alt"],[1,"mb-2","text-lg","font-bold","flex","items-center","gap-2"],[1,"rounded-xl","container-custom","p-6","transition","duration-300","hover:border-blue-500/50","hover:shadow-xl","md:col-start-1","md:row-start-3"],[1,"rounded-xl","overflow-hidden","w-full","aspect-square","md:col-start-2","md:row-start-3"],["loading","lazy",1,"w-full","h-full","object-cover",3,"error","src","alt"],[1,"mb-6","pb-2","text-3xl","font-bold","flex","items-center","gap-3"],["src","images/logos/cronologia.png","alt","Icono de Cronolog\xEDa de eventos","loading","lazy",1,"h-14"],[1,"space-y-6"],[1,"container-custom","border-cronologia","flex","gap-6","px-6","py-3"],[1,"flex-shrink-0","flex","items-center","gap-3"],[1,"rounded-full","px-4","py-2","text-sm","font-bold"],[1,"flex-grow"],[1,""]],template:function(e,i){e&1&&(d(0,"div",0),f(1,Je,49,12),c()),e&2&&(r(),_(i.event?1:-1))},dependencies:[oe,V,le],styles:[".heigth-full[_ngcontent-%COMP%]{height:150%}.border-cronologia[_ngcontent-%COMP%]{border-radius:.4rem}.border-title[_ngcontent-%COMP%]{border-bottom:solid 2px #e1c7b1}.imagen-dato-curioso[_ngcontent-%COMP%]{width:100%;height:300px;object-fit:cover}.icon-transparent[_ngcontent-%COMP%]{background:transparent!important;background-color:transparent!important}"]})};export{ge as EventDetail};
