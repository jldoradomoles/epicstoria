import{f as d,h as c,i as f,r as S}from"./chunk-XDCWJPAS.js";import{I as s,M as g,Q as n,Qb as a,R as l,a as h,ha as u,l as i,ra as p,x as r}from"./chunk-C264W5OG.js";var m={production:!0,apiUrl:"",useStaticData:!0};var v=class o{constructor(e,t){this.http=e;this.router=t;this.checkAuthStatus()}apiUrl=m.apiUrl;TOKEN_KEY="epicstoria_token";USER_KEY="epicstoria_user";platformId=l(p);isBrowser=d(this.platformId);currentUserSignal=u(this.getStoredUser());isLoadingSignal=u(!1);currentUser=a(()=>this.currentUserSignal());isAuthenticated=a(()=>this.currentUserSignal()!==null);isLoading=a(()=>this.isLoadingSignal());getStoredUser(){if(!this.isBrowser)return null;let e=sessionStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}getStoredToken(){return this.isBrowser?sessionStorage.getItem(this.TOKEN_KEY):null}setAuth(e,t){this.isBrowser&&(sessionStorage.setItem(this.TOKEN_KEY,t),sessionStorage.setItem(this.USER_KEY,JSON.stringify(e)),this.currentUserSignal.set(e))}clearAuth(){this.isBrowser&&(sessionStorage.removeItem(this.TOKEN_KEY),sessionStorage.removeItem(this.USER_KEY),this.currentUserSignal.set(null))}getToken(){return this.getStoredToken()}getAuthHeaders(){let e=this.getToken();return new c(h({"Content-Type":"application/json"},e?{Authorization:`Bearer ${e}`}:{}))}register(e){return this.isLoadingSignal.set(!0),this.http.post(`${this.apiUrl}/auth/register`,e).pipe(s(t=>{t.success&&this.setAuth(t.data.user,t.data.token),this.isLoadingSignal.set(!1)}),r(t=>(this.isLoadingSignal.set(!1),i(()=>t))))}login(e){return this.isLoadingSignal.set(!0),this.http.post(`${this.apiUrl}/auth/login`,e).pipe(s(t=>{t.success&&this.setAuth(t.data.user,t.data.token),this.isLoadingSignal.set(!1)}),r(t=>(this.isLoadingSignal.set(!1),i(()=>t))))}logout(){this.clearAuth(),this.router.navigate(["/"])}getProfile(){return this.http.get(`${this.apiUrl}/auth/profile`,{headers:this.getAuthHeaders()}).pipe(s(e=>{e.success&&(this.currentUserSignal.set(e.data),sessionStorage.setItem(this.USER_KEY,JSON.stringify(e.data)))}))}updateProfile(e){return this.isLoadingSignal.set(!0),this.http.put(`${this.apiUrl}/auth/profile`,e,{headers:this.getAuthHeaders()}).pipe(s(t=>{t.success&&(this.currentUserSignal.set(t.data),sessionStorage.setItem(this.USER_KEY,JSON.stringify(t.data))),this.isLoadingSignal.set(!1)}),r(t=>(this.isLoadingSignal.set(!1),i(()=>t))))}changePassword(e){return this.isLoadingSignal.set(!0),this.http.put(`${this.apiUrl}/auth/change-password`,e,{headers:this.getAuthHeaders()}).pipe(s(()=>{this.isLoadingSignal.set(!1)}),r(t=>(this.isLoadingSignal.set(!1),i(()=>t))))}checkAuthStatus(){this.getStoredToken()&&this.getProfile().subscribe({error:()=>{this.clearAuth()}})}refreshProfile(){this.getProfile().subscribe({error:e=>{console.error("Error refreshing profile:",e)}})}static \u0275fac=function(t){return new(t||o)(n(f),n(S))};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,v as b};
